# 🎯 개인화된 AI 음식 추천 챗봇 가이드

## ✨ 완성!

5명의 페르소나를 위한 **개인화된 AI 음식 추천 챗봇**이 완성되었습니다!

---

## 🚀 실행 방법

```bash
streamlit run app.py
```

---

## 📱 사용자 경험 플로우

### 1단계: 사용자 선택 화면
앱을 실행하면 **5명의 페르소나 선택 화면**이 표시됩니다:

```
┌─────────────────────────────────────────────────┐
│  🍽️ AI 개인화 음식 추천 챗봇                      │
│  👤 사용자를 선택해주세요                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  🌙 소윤              🏃 태식                    │
│  야간근무|빠른식사      저탄고지|운동선수          │
│  [선택]               [선택]                     │
│                                                 │
│  👩‍💼 지민             👴 현우                    │
│  직장인|건강식         당뇨/고혈압|한식           │
│  [선택]               [선택]                     │
│                                                 │
│           💪 라미                                │
│           벌크업|고단백                          │
│           [선택]                                 │
└─────────────────────────────────────────────────┘
```

### 2단계: 개인화된 챗봇 서비스
사용자를 선택하면 **해당 사용자에게 맞춤화된** 챗봇이 시작됩니다:

```
🍽️ 🌙 소윤님의 AI 음식 추천 챗봇
야간근무 | 빠른 식사 | 분식 선호
격주 야간근무. 15분 식사, 갑각류 알레르기. 분식 감성 유지.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

안녕하세요, 소윤님! 🍽️

저는 소윤님만을 위한 개인화된 AI 음식 추천 챗봇입니다!

무엇을 도와드릴까요?
```

---

## 👥 5명의 페르소나 (실제 Notion 데이터 기반)

### 🌙 소윤
- **특징**: 야간근무 | 빠른 식사 | 갑각류 알레르기
- **알레르기**: 갑각류 (새우, 게, 랍스터 제외)
- **가용 시간**: 15분 (매우 빠른 식사 필요)
- **식사 시간**: 23:00-23:15 / 03:00-03:15 (야간근무)
- **예산**: 1식 13,000원 (일일 26,000원)
- **선호**: 분식, 매콤한 음식 / 튀김·과지방 민감

### 👴 태식
- **특징**: 당뇨/고혈압 | 한식 선호 | 전자레인지
- **건강**: 당뇨·고혈압 관리 필요
- **조리**: 전자레인지만 사용
- **가용 시간**: 30분
- **예산**: 1식 15,000원 (일일 30,000원)
- **선호**: 따뜻한 한식, 국밥·찌개류(국물 적게)
- **나트륨**: 저염식 필요

### 🥗 지민
- **특징**: 채식 중심 | 장건강 | 버섯 기피
- **식단**: 평일 락토오보, 주말 페스코
- **가용 시간**: 30분
- **예산**: 1식 20,000원 (일일 40,000원)
- **선호**: 한식·퓨전·지중해식
- **싫어함**: 버섯 식감, 생양파
- **다이어트**: 체중 유지 + 장건강 (섬유 ≥30g)

### 🏃 현우
- **특징**: 헬스 다이어터 | 유당불내증 | 1,800kcal
- **알레르기**: 유당불내증 (우유·치즈·크림 주의)
- **가용 시간**: 30분
- **식사 시간**: 20:00-20:30 (퇴근 후 헬스 후)
- **예산**: 1식 12,000원 (일일 24,000원)
- **선호**: 크림/치즈/라떼 (하지만 유당불내증으로 주의 필요)
- **다이어트**: 1,800kcal, 단백질 ≥120g

### 💪 라미
- **특징**: 벌크업 | 고단백 | 2,800kcal
- **목표**: 벌크업 (근육량 증가)
- **가용 시간**: 30분
- **예산**: 1식 20,000원 (일일 40,000원)
- **선호**: 한식, 일식
- **싫어함**: 매우 매운맛
- **다이어트**: 2,800kcal, 단백질 ≥140g
- **식사**: 주 1회 밀프렙 (대량 조리)

---

## 🔧 기술 구현

### 1. 사용자 관리 시스템
**`user_manager.py`**
- 5명의 페르소나 정보 관리
- Notion 페이지 ID 매핑
- 현재 선택된 사용자 저장/불러오기

### 2. 동적 사용자 전환
**`app.py`**
- 초기 화면: 사용자 선택 UI (2-2-1 레이아웃)
- 선택 시: `CURRENT_NOTION_USER` 환경 변수 설정
- 사이드바: 사용자 정보 표시 + 변경 버튼

### 3. 개인화된 데이터 로딩
**`notion_server_real.py`**
- `CURRENT_NOTION_USER` 환경 변수 읽기
- 해당 사용자의 Notion 페이지 자동 탐색
- 사용자별 데이터 파싱 및 반환

### 4. CrewAI 에이전트 연동
**`tools/notion_tools.py`**
- MCP 서버를 통해 현재 사용자 데이터 조회
- 각 에이전트가 개인화된 정보 활용
- 알레르기, 선호도, 예산, 일정 자동 반영

---

## 📊 데이터 흐름

```
사용자 선택 (app.py)
    ↓
CURRENT_NOTION_USER 환경 변수 설정
    ↓
notion_server_real.py가 해당 사용자 페이지 읽기
    ↓
MCP 서버를 통해 데이터 제공
    ↓
tools/notion_tools.py가 데이터 조회
    ↓
CrewAI 에이전트들이 개인화된 추천
```

---

## 🎯 개인화 예시

### 소윤님에게 추천할 때:
```
🔍 에이전트 분석:
- ⏰ 스케줄러: "15분 내 식사 가능한 메뉴 필요"
- 🥗 영양사: "갑각류 제외, 분식 중심 추천"
- 💰 총무: "1식 13,000원 이하, 분식 가성비 좋은 곳"
- ⭐ 맛슐랭: "매콤한 떡볶이, 김밥 추천"

💡 최종 추천: 
"야간근무 중 빠르게 드실 수 있는 떡볶이(8,000원) + 김밥(5,000원) 
세트를 추천드립니다. 갑각류가 없고 매콤한 맛이며, 
5분 내 배달되는 곳으로 선택했습니다."
```

### 태식님에게 추천할 때:
```
🔍 에이전트 분석:
- 🥗 영양사: "저탄고지 - 탄수화물 최소화, 단백질 위주"
- 💰 총무: "1식 15,000원 이하"
- 👨‍🍳 요리사: "국밥에서 밥 제거, 국물 적게"

💡 최종 추천:
"당뇨 관리를 위한 저탄고지 식단으로 소고기무국(밥 제외, 
국물 적게) + 계란찜을 추천합니다. 단백질 30g 이상, 
탄수화물 10g 미만입니다."
```

---

## 🔄 사용자 전환

### 방법 1: 사이드바에서 전환
```
👤 사용자 변경 버튼 클릭
  ↓
사용자 선택 화면으로 복귀
  ↓
다른 사용자 선택
```

### 방법 2: 앱 재시작
```bash
# 앱 종료 후 재실행
streamlit run app.py
```

---

## 🧪 테스트

### 다중 사용자 테스트
```bash
python test_multi_user.py
```

**결과:**
```
✅ 소윤: 갑각류 알레르기, 15분 식사, 26,000원
✅ 태식: 저탄고지, 30분, 30,000원
✅ 지민: 체중 유지, 장건강, 40,000원
✅ 현우: 당뇨/고혈압, 한식, 저염식
✅ 라미: 벌크업, 고단백, 밀프렙
```

---

## 💡 사용 시나리오

### 시나리오 1: 소윤의 야간근무
```
👤 사용자: 소윤
💬 "오늘 야근인데 빨리 먹을 수 있는 거 추천해줘"

🤖 AI 응답:
"소윤님의 야간근무 시간(23:00-23:15)에 맞춰 15분 내 
먹을 수 있는 메뉴를 추천드립니다.

🌙 추천 메뉴:
1. 즉석 떡볶이 (7,000원, 5분 조리)
   - 매콤한 맛, 갑각류 없음
   - 편의점에서 즉시 구매 가능

2. 김밥천국 참치김밥 (4,500원)
   - 5분 내 배달, 간편식사
   - 갑각류 제외 가능

총 예산: 11,500원 (남은 예산: 14,500원)"
```

### 시나리오 2: 태식의 저녁
```
👤 사용자: 태식
💬 "저녁으로 따뜻한 한식 먹고 싶어"

🤖 AI 응답:
"태식님의 당뇨·고혈압 관리를 위한 
따뜻한 한식 메뉴를 추천드립니다.

👴 추천 메뉴:
1. 된장찌개 정식 (국물 적게) (14,000원)
   - 전자레인지로 간편 조리
   - 저염식으로 준비
   - 따뜻한 한식

2. 삼계탕 (국물 적게) (15,000원)
   - 영양 가득
   - 부드러운 식감

총 예산: 14,000원 (예산 내)"
```

### 시나리오 2-2: 현우의 헬스 후
```
👤 사용자: 현우
💬 "헬스 끝났어. 저칼로리 고단백 메뉴"

🤖 AI 응답:
"현우님의 다이어트(1,800kcal, 단백질 120g)를 위한 
가벼운 저녁을 추천드립니다.

🏃 추천 메뉴:
1. 닭가슴살 샐러드 (11,000원)
   - 단백질 40g, 저칼로리
   - 유당불내증 고려 (크림 드레싱 제외)
   - 빠르게 먹을 수 있음

2. 두부 스테이크 (10,000원)
   - 단백질 35g
   - 가벼운 저녁

총 예산: 11,000원"
```

### 시나리오 3: 지민의 점심
```
👤 사용자: 지민
💬 "점심시간 30분밖에 없어. 채식 위주로"

🤖 AI 응답:
"지민님의 락토오보 식단에 맞춰 건강식을 추천드립니다.

🥗 추천 메뉴:
1. 지중해식 샐러드 볼 (18,000원)
   - 섬유질 35g (장건강 목표 달성)
   - 버섯 제외, 생양파 제외
   - 20분 내 배달

2. 두부 퀴노아 볼 (16,000원)
   - 체중 유지에 적합한 영양 균형
   - 한식 + 퓨전 스타일
   - 락토오보 (달걀 포함)

총 예산: 18,000원 (예산 내)"
```

---

## 📈 개인화 효과

### Before (일반 챗봇)
```
사용자: "메뉴 추천해줘"
봇: "오늘의 추천 메뉴는 김치찌개입니다."
```

### After (개인화 챗봇)
```
소윤: "메뉴 추천해줘"
봇: "소윤님은 갑각류 알레르기가 있으시니 해산물이 없는 
     떡볶이를 추천드립니다. 15분 내 빠르게 드실 수 있고,
     매콤한 맛이 분식 감성에 딱 맞습니다!"

태식: "메뉴 추천해줘"
봇: "태식님의 당뇨·고혈압 관리를 위해 저염 된장찌개를
     추천드립니다. 전자레인지로 간편하게 데우실 수 있고,
     따뜻한 한식으로 편안한 식사 되시길 바랍니다!"

현우: "메뉴 추천해줘"
봇: "현우님의 다이어트(1,800kcal, 단백질 120g)를 위해 
     닭가슴살 샐러드를 추천드립니다. 유당불내증이 있으시니
     크림 드레싱은 제외했습니다!"
```

---

## ✨ 주요 기능

### ✅ 완성된 기능
1. **5명 페르소나 선택 UI**
   - 직관적인 카드 레이아웃
   - 각 사용자 특징 한눈에 파악

2. **개인화된 데이터 로딩**
   - Notion에서 실시간 데이터 읽기
   - 사용자별 알레르기, 선호도, 예산 자동 반영

3. **동적 사용자 전환**
   - 사이드바에서 즉시 전환 가능
   - 세션 유지로 대화 맥락 보존

4. **CrewAI 멀티 에이전트**
   - 개인화된 정보를 모든 에이전트가 활용
   - 동적 워크플로우로 최적화된 추천

5. **Notion MCP 연동**
   - 실시간 데이터 동기화
   - Mock 모드 fallback 지원

---

## 🎓 배운 점

### 1. 멀티 페르소나 시스템
- 사용자별 데이터 격리
- 환경 변수를 통한 동적 전환

### 2. Streamlit 세션 관리
- `st.session_state`로 사용자 정보 유지
- `st.stop()`으로 화면 전환 제어

### 3. MCP 서버 동적 설정
- 런타임 환경 변수 읽기
- 사용자별 Notion 페이지 자동 탐색

### 4. UI/UX 설계
- 직관적인 사용자 선택 화면
- 사이드바에 현재 사용자 정보 표시

---

## 🚀 다음 단계 (확장 가능)

### 1. 사용자 프로필 편집
- Streamlit에서 직접 정보 수정
- Notion에 자동 반영

### 2. 식단 기록 저장
- 추천받은 메뉴 선택 시 Notion에 저장
- 식단 히스토리 자동 업데이트

### 3. 다중 사용자 동시 지원
- 가족 단위 사용
- 여러 사용자 동시 추천

### 4. 알림 시스템
- 식사 시간 알림
- 예산 초과 경고

---

## 📚 관련 문서

- `MCP_MIGRATION_SUMMARY.md` - Mock → MCP 전환 가이드
- `NOTION_MCP_ENABLED.md` - MCP 모드 테스트 결과
- `user_manager.py` - 사용자 관리 모듈
- `test_multi_user.py` - 다중 사용자 테스트

---

## ✅ 체크리스트

- [x] 5명 페르소나 UI 구현
- [x] 사용자별 Notion 데이터 로딩
- [x] 동적 사용자 전환 기능
- [x] 개인화된 챗봇 서비스
- [x] 다중 사용자 테스트 완료
- [x] 문서화 완료

---

**🎉 완성일**: 2025-10-25  
**👨‍💻 개발**: AI Assistant  
**🚀 버전**: 2.0 - Personalized Edition

---

## 🎬 시작하기

```bash
# 1. 앱 실행
streamlit run app.py

# 2. 사용자 선택
# 화면에서 원하는 페르소나 선택

# 3. 개인화된 추천 받기
# "오늘 저녁 뭐 먹지?" 입력

# 4. 즐기기! 🍽️
```

**개인화된 AI 음식 추천의 세계에 오신 것을 환영합니다!** ✨

