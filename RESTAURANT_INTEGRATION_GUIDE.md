# 🍽️ 레스토랑 DB 통합 가이드

## 📋 개요

`식당_DB.json` 파일을 활용한 **개인화된 레스토랑 추천 시스템**이 완성되었습니다!

이제 사용자가 **외식/배달**을 원할 때, 5명의 AI 에이전트가 협력하여 **예산, 시간, 영양, 선호도**를 모두 고려한 최적의 레스토랑을 추천합니다.

---

## 🎯 주요 기능

### 1. 식당_DB.json 활용
- **2,300개 이상의 실제 레스토랑 데이터**
- 메뉴 이름, 가격, 배달/매장 예상 소요시간 포함
- Mock 배달앱 데이터로 실제 배달 서비스를 시뮬레이션

### 2. 다차원 필터링
- **예산**: 남은 예산 범위 내에서만 추천
- **시간**: 가용 시간 내 배달/식사 가능한 식당만 필터링
- **영양**: 알레르기 안전 및 영양 균형 고려
- **선호도**: 사용자 취향 및 과거 식사 기록 반영

### 3. 페르소나별 개인화
- 각 페르소나의 Notion 데이터 활용
- 예산, 일정, 선호도가 다른 5명의 페르소나에 맞춤 추천

---

## 🛠️ 구현 내용

### 새로운 도구 추가 (`tools/restaurant_tools.py`)

#### 1. `search_restaurants()`
예산과 시간 제약을 고려하여 레스토랑 검색
```python
레스토랑 검색 (예산 및 시간 기반)(
    max_budget=15000,           # 최대 예산
    max_time_minutes=30,         # 최대 시간
    meal_type="배달",            # "배달" 또는 "매장"
    keyword="파스타"             # 검색 키워드 (선택)
)
```

#### 2. `get_restaurant_details()`
특정 레스토랑의 상세 정보 조회
```python
레스토랑 상세 정보 조회(restaurant_name="시골식당")
```

#### 3. `recommend_best_value_restaurants()`
가성비가 좋은 레스토랑 TOP 5 추천
```python
예산 최적화 레스토랑 추천(
    max_budget=10000,
    max_time_minutes=30,
    meal_type="배달"
)
```

#### 4. `search_by_menu()`
특정 메뉴를 제공하는 레스토랑 검색
```python
메뉴 기반 레스토랑 검색(
    menu_keywords="칼국수",
    max_budget=10000,
    max_time_minutes=30
)
```

---

## 👥 에이전트별 역할

### 1. **예산 관리자 (Budget Agent)**
- Notion 예산 데이터 확인
- `예산 최적화 레스토랑 추천` 도구로 가성비 좋은 식당 검색
- 예산 초과 식당 필터링

### 2. **일정 관리자 (Scheduler Agent)**
- Notion 일정 데이터 확인
- `레스토랑 검색 (예산 및 시간 기반)` 도구로 시간 내 가능한 식당 필터링
- 배달 vs 매장 식사 판단

### 3. **영양사 (Nutrition Agent)**
- 알레르기 정보 확인 (최우선!)
- `메뉴 기반 레스토랑 검색` 도구로 영양학적으로 적합한 메뉴 찾기
- 부족한 영양소 보충 가능 메뉴 추천

### 4. **맛슐랭 (Taste Agent)**
- `레스토랑 상세 정보 조회` 도구로 메뉴와 식당 정보 확인
- 사용자 선호도 및 과거 기록 반영
- 최종 2-3개 레스토랑 추천

---

## 🚀 사용 방법

### 1. 외식/배달 요청 예시
```python
# Streamlit 앱에서
"오늘 외식하고 싶어"
"배달 시켜먹을래"
"레스토랑 추천해줘"
"시켜먹을 수 있는 거 알려줘"
```

### 2. 워크플로우 자동 인식
사용자가 **"외식", "배달", "레스토랑"** 등의 키워드를 사용하면:
- 오케스트레이터가 자동으로 `RESTAURANT_DELIVERY` 워크플로우 선택
- 식당_DB.json에서만 추천 (AI가 임의로 만든 식당 제외)

### 3. 추천 결과 예시
```
🍽️ 최종 레스토랑 추천

1. 시골식당
   📍 설명: 정동진 관광지 근처의 망치매운탕 전문점
   
   🍲 추천 메뉴:
   - 매운탕: ₩5,000
   - 해물칼국수: ₩5,000
   
   ⏰ 배달 예상 시간: 25분
   🕐 영업시간: 주중 09:00 ~ 18:00
   
   ✅ 선정 이유:
   - 예산 내 (₩10,000 남음)
   - 시간 내 (30분 이내)
   - 해산물로 단백질 보충 가능
   - 매운탕은 사용자의 선호 메뉴

2. 네코짱
   📍 설명: 일본 라멘 전문점, 깊고 진한 육수
   
   🍜 추천 메뉴:
   - 소유라멘: ₩6,500
   - 탄탄멘: ₩6,500
   
   ⏰ 배달 예상 시간: 30분
   🕐 영업시간: 매일 11:30 ~ 21:30
   
   ✅ 선정 이유:
   - 가성비 우수
   - 30분 이내 배달 가능
   - 라멘은 사용자가 자주 먹는 메뉴
```

---

## 📊 데이터 구조

### 식당_DB.json 형식
```json
{
  "id": 253804,
  "name": "시골식당",
  "desc": "망치매운탕이 유명한 매운탕 전문 한식당",
  "hours": "영업시간:주중 09:00 ~ 18:00",
  "holidays": "연휴-설날 전체,연휴-추석 당일...",
  "menu": [
    {
      "name": "매운탕",
      "price": 5000,
      "price_krw": "₩5,000"
    }
  ],
  "배달 예상 소요시간": "25분",
  "매장 식사 예상 소요시간": "40분"
}
```

---

## 🎨 워크플로우 흐름

```
사용자 요청
    ↓
오케스트레이터 (의도 분석)
    ↓
RESTAURANT_DELIVERY 워크플로우 선택
    ↓
┌─────────────────────────────────────┐
│  1. 예산 관리자                       │
│  - Notion 예산 확인                  │
│  - 가성비 좋은 레스토랑 검색         │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  2. 일정 관리자                       │
│  - Notion 일정 확인                  │
│  - 시간 내 가능한 레스토랑 필터링    │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  3. 영양사                            │
│  - 알레르기 확인                     │
│  - 영양학적으로 적합한 메뉴 선정     │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  4. 맛슐랭                            │
│  - 레스토랑 상세 정보 확인           │
│  - 최종 2-3개 레스토랑 추천          │
└─────────────────────────────────────┘
    ↓
사용자에게 결과 제공
```

---

## 🔧 커스터마이징

### 1. 식당 DB 업데이트
`식당_DB.json` 파일을 수정하여 새로운 레스토랑 추가 가능:
```json
{
  "id": 999999,
  "name": "새로운식당",
  "desc": "설명",
  "hours": "영업시간",
  "holidays": "휴무일",
  "menu": [
    {"name": "메뉴1", "price": 10000, "price_krw": "₩10,000"}
  ],
  "배달 예상 소요시간": "30분",
  "매장 식사 예상 소요시간": "45분"
}
```

### 2. 필터링 조건 조정
`tools/restaurant_tools.py`에서 필터링 로직 수정 가능:
- 예산 범위
- 시간 제약
- 가성비 점수 계산 방식

### 3. 추천 개수 변경
각 에이전트의 Task description에서 추천 개수 조정:
```python
"5. 예산 내에서 가성비가 좋은 레스토랑 3-5개를 선정하세요."
# → "5. 예산 내에서 가성비가 좋은 레스토랑 5-10개를 선정하세요."
```

---

## ✅ 테스트 시나리오

### 시나리오 1: 예산 제약이 강한 경우
```
사용자: "10,000원 이하로 배달 시켜먹을 수 있는 거 추천해줘"
→ 예산 관리자가 10,000원 이하 식당만 필터링
→ 가성비 좋은 식당 우선 추천
```

### 시나리오 2: 시간이 촉박한 경우
```
사용자: "20분 안에 먹을 수 있는 거 배달시켜줘"
→ 일정 관리자가 20분 이내 배달 가능 식당만 필터링
→ 빠른 배달 식당 우선 추천
```

### 시나리오 3: 알레르기가 있는 경우
```
사용자: "오늘 외식하고 싶어" (Notion에 땅콩 알레르기 기록됨)
→ 영양사가 알레르기 정보 확인
→ 땅콩 포함 메뉴 자동 제외
```

### 시나리오 4: 특정 메뉴 원하는 경우
```
사용자: "파스타 먹고 싶은데 배달해줘"
→ 맛슐랭이 '메뉴 기반 레스토랑 검색' 도구로 파스타 제공 식당 찾기
→ 예산/시간 고려하여 최적 식당 추천
```

---

## 🎯 핵심 특징

### 1. 실제 데이터 활용
- AI가 임의로 만든 식당 ❌
- 식당_DB.json에 있는 실제 데이터만 사용 ✅

### 2. 다차원 개인화
- Notion 데이터 실시간 활용
- 5개 제약 조건 동시 만족 (예산, 시간, 영양, 알레르기, 선호도)

### 3. 효율적인 워크플로우
- 필요한 에이전트만 활성화
- 외식/배달 요청 시 요리사 에이전트 제외

### 4. 명확한 정보 제공
- 메뉴명, 가격, 배달 시간 모두 표시
- 사용자가 바로 주문/방문 가능하도록 구체적 정보 제공

---

## 📌 주의사항

1. **식당_DB.json 필수**
   - 파일이 없으면 레스토랑 추천 불가
   - 프로젝트 루트에 위치해야 함

2. **에이전트 도구 권한**
   - 모든 에이전트가 레스토랑 도구 접근 가능
   - 각 에이전트는 자신의 역할에 맞는 도구만 사용

3. **워크플로우 선택**
   - "외식", "배달" 키워드 없으면 FULL_RECOMMENDATION (집밥 추천)
   - 명확하지 않을 경우 사용자에게 재확인

---

## 🚀 향후 개선 방향

### 1. 실제 배달앱 API 연동
- 배달의민족, 쿠팡이츠 등 API 연동
- 실시간 메뉴/가격/배달시간 업데이트

### 2. 사용자 리뷰 반영
- Notion에 식당 리뷰 저장
- 과거 주문 이력 기반 추천

### 3. 위치 기반 필터링
- GPS 위치 활용
- 거리 기반 배달 시간 계산

### 4. 할인/쿠폰 정보
- 프로모션 정보 크롤링
- 예산 관리자가 할인 고려

---

## 📝 결론

**식당_DB.json**을 활용한 레스토랑 추천 시스템이 완성되었습니다!

- ✅ 2,300개 이상의 실제 레스토랑 데이터
- ✅ 예산, 시간, 영양, 선호도 모두 고려
- ✅ 5명의 페르소나별 개인화 추천
- ✅ 배달 vs 매장 식사 자동 판단

이제 사용자는 **"오늘 외식하고 싶어"**라고만 말하면, AI 에이전트들이 협력하여 **최적의 레스토랑**을 추천해줍니다! 🎉

---

## 🔗 관련 파일

- `식당_DB.json` - 레스토랑 데이터베이스
- `tools/restaurant_tools.py` - 레스토랑 검색 도구
- `agents/budget_agent.py` - 예산 기반 필터링
- `agents/scheduler_agent.py` - 시간 기반 필터링
- `agents/nutrition_agent.py` - 영양 및 알레르기 검증
- `agents/taste_agent.py` - 최종 추천
- `agents/orchestrator_agent.py` - 워크플로우 선택
- `crew.py` - RESTAURANT_DELIVERY 워크플로우 구현

